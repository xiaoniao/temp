<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.kunyao.assistant.web.dao.MemberInfoMapper">
	<resultMap id="BaseResultMap" type="com.kunyao.assistant.core.model.MemberInfo">
	   <id column="id" property="id" jdbcType="INTEGER" />
	   <result column="name" property="name" jdbcType="VARCHAR" />
	   <result column="sex" property="sex" jdbcType="INTEGER" />
	   <result column="header" property="header" jdbcType="VARCHAR" />
	   <result column="address" property="address" jdbcType="VARCHAR" />
	   <result column="idcard" property="idcard" jdbcType="VARCHAR" />
	   <result column="idcard_pic1" property="idcardPic1" jdbcType="VARCHAR" />
	   <result column="idcard_pic2" property="idcardPic2" jdbcType="VARCHAR" />
	   <result column="idcard_check_pass_status" property="idcardCheckPassStatus" jdbcType="INTEGER" />
	   <result column="bank_people" property="bankPeople" jdbcType="VARCHAR" />
	   <result column="bank_card" property="bankCard" jdbcType="VARCHAR" />
	   <result column="bank_card_type" property="bankCardType" jdbcType="VARCHAR" />
	   <result column="bank_mobile" property="bankMobile" jdbcType="VARCHAR" />
	   <result column="native_place" property="nativePlace" jdbcType="VARCHAR" />
	   <result column="live_place" property="livePlace" jdbcType="VARCHAR" />
	   <result column="business" property="business" jdbcType="VARCHAR" />
	   <result column="company" property="company" jdbcType="VARCHAR"/>
	   <result column="position" property="position" jdbcType="VARCHAR" />
	   <result column="travel_frequency" property="travelFrequency" jdbcType="VARCHAR" />
	   <result column="habit" property="habit" jdbcType="VARCHAR" />
	   <result column="taboo" property="taboo" jdbcType="VARCHAR" />
	   <result column="open_id" property="openId" jdbcType="VARCHAR" />
	   <result column="getui_id" property="getuiId" jdbcType="VARCHAR" />
	   <result column="user_id" property="userId" jdbcType="INTEGER" />
	</resultMap>

	<select id="selectListByCondition" resultMap="BaseResultMap" parameterType="com.kunyao.assistant.core.model.MemberInfo">
	   	SELECT  
	   		mi.id, mi.name, mi.sex, mi.header, mi.address, mi.idcard, mi.idcard_pic1, mi.idcard_pic2, mi.idcard_check_pass_status,
	   		mi.bank_people, mi.bank_card, mi.bank_card_type, mi.bank_mobile, mi.native_place, mi.live_place, mi.business, mi.company,
	   		mi.position, mi.travel_frequency, mi.habit, mi.taboo, mi.open_id, mi.getui_id, mi.user_id, uu.username as userName,
	   		uu.create_time as createDate, uu.last_login_time as	lastLoginDate, uu.status as status	
	    FROM 
	    	kycom_u_member_info mi
	    LEFT JOIN
	    	kycom_u_user uu ON mi.user_id = uu.id	    	    	                                                              				                                                      					                                                                                                 					                                                    
	   <where>
	   	   <if test="memberInfo.id != null">
	   	   		mi.id = #{memberInfo.id, jdbcType=INTEGER}
	   	   </if> 
	   	   <if test="memberInfo.registrationTimeMin != null and memberInfo.registrationTimeMin != '' and memberInfo.registrationTimeMax != null and memberInfo.registrationTimeMax != ''">
	       		AND (uu.create_time <![CDATA[ >= ]]> #{memberInfo.registrationTimeMin, jdbcType=VARCHAR} AND uu.create_time <![CDATA[ < ]]> #{memberInfo.registrationTimeMax, jdbcType=VARCHAR})
	       </if> 
	       <if test="memberInfo.lastLoginTimeMin != null and memberInfo.lastLoginTimeMin != '' and memberInfo.lastLoginTimeMax != null and memberInfo.lastLoginTimeMax != ''">
	       		AND (uu.last_login_time <![CDATA[ >= ]]> #{memberInfo.lastLoginTimeMin, jdbcType=VARCHAR} AND uu.last_login_time <![CDATA[ < ]]> #{memberInfo.lastLoginTimeMax, jdbcType=VARCHAR})
	       </if>
	       <if test="memberInfo.idcardCheckPassStatus != null">
	       		and mi.idcard_check_pass_status = #{memberInfo.idcardCheckPassStatus, jdbcType=INTEGER}
	       </if>
	       <if test="memberInfo.userName != null">
	       		and uu.username = #{memberInfo.userName, jdbcType=VARCHAR}
	       </if>  
	       <if test="memberInfo.name != null">
	       		and mi.name LIKE '%${memberInfo.name}%'
	       </if> 
	       <if test="memberInfo.statusBy == 'audit'">
	       		and (mi.idcard_check_pass_status = 0 or mi.idcard_check_pass_status = 1 or mi.idcard_check_pass_status = 2) 
	       </if> 
	       <if test="memberInfo.status != null">
	       		and uu.status = #{memberInfo.status, jdbcType=INTEGER} 
	       </if> 
	   </where>    
	   <if test="startpos != null and pagesize != null"> 
	       LIMIT #{startpos, jdbcType=INTEGER}, #{pagesize, jdbcType=INTEGER}
	   </if>
	</select>
	
	<select id="selectCountByCondition" resultType="int">
        SELECT  
	   		count(0)	
	    FROM 
	    	kycom_u_member_info mi
	    LEFT JOIN
	    	kycom_u_user uu ON mi.user_id = uu.id
	    <where>
	       <if test="memberInfo.registrationTimeMin != null and memberInfo.registrationTimeMin != '' and memberInfo.registrationTimeMax != null and memberInfo.registrationTimeMax != ''">
	       		AND (uu.create_time <![CDATA[ >= ]]> #{memberInfo.registrationTimeMin, jdbcType=VARCHAR} AND uu.create_time <![CDATA[ < ]]> #{memberInfo.registrationTimeMax, jdbcType=VARCHAR})
	       </if> 
	       <if test="memberInfo.lastLoginTimeMin != null and memberInfo.lastLoginTimeMin != '' and memberInfo.lastLoginTimeMax != null and memberInfo.lastLoginTimeMax != ''">
	       		AND (uu.last_login_time <![CDATA[ >= ]]> #{memberInfo.lastLoginTimeMin, jdbcType=VARCHAR} AND uu.last_login_time <![CDATA[ < ]]> #{memberInfo.lastLoginTimeMax, jdbcType=VARCHAR})
	       </if>
	       <if test="memberInfo.idcardCheckPassStatus != null">
	       		and mi.idcard_check_pass_status = #{memberInfo.idcardCheckPassStatus, jdbcType=INTEGER}
	       </if>
	       <if test="memberInfo.userName != null">
	       		and uu.username = #{memberInfo.userName, jdbcType=VARCHAR}
	       </if>  
	       <if test="memberInfo.name != null">
	       		and mi.name LIKE '%${memberInfo.name}%'
	       </if> 
	       <if test="memberInfo.statusBy == 'audit'">
	       		and (mi.idcard_check_pass_status = 0 or mi.idcard_check_pass_status = 1 or mi.idcard_check_pass_status = 2) 
	       </if>
	       <if test="memberInfo.status != null">
	       		and uu.status = #{memberInfo.status, jdbcType=INTEGER} 
	       </if>  
	    </where> 	
	</select>	    
</mapper>